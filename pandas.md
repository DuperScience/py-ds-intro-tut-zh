# Python 和 Pandas 数据分析教程

大家好，欢迎阅读 Python 和 Pandas 数据分析系列教程。 Pandas 是一个 Python 模块，Python 是我们要使用的编程语言。Pandas 模块是一个高性能，高效率，高水平的数据分析库。

它的核心就像操作一个电子表格的无头版本，比如 Excel。你使用的大多数数据集将是所谓的数据帧（`DataFrame`）。您可能已经熟悉这个术语，它也用于其他语言，但是如果没有，数据帧通常就像电子表格一样，拥有列和行，这就是它了！从这里开始，我们可以利用 Pandas 以闪电般的速度操作我们的数据集。

Pandas 还与许多其他数据分析库兼容，如用于机器学习的 Scikit-Learn，用于图形的 Matplotlib，NumPy，因为它使用 NumPy ，以及其他。这些是非常强大和宝贵的。如果你发现自己使用 Excel 或者一般电子表格来执行各种计算任务，那么他们可能需要一分钟或者一小时来运行，Pandas 将会改变你的生活。我甚至已经看到机器学习的版本，如 K-Means 聚类在 Excel 上完成。这真的很酷，但是我的 Python 会为你做得更快，这也将使你对参数要求更严格，拥有更大的数据集，并且能够完成更多的工作。

还有一个好消息。你可以很容易加载和输出`xls`或`xlsx`格式的文件，所以，即使你的老板想用旧的方式来查看，他们也可以。Pandas 还可以兼容文本文件，`csv`，`hdf`文件，`xml`，`html`等等，其 IO 非常强大。

如果您刚刚入门 Python，那么您应该可以继续学习，而不必精通 Python，这甚至可以让你入门 Python 。最重要的是，如果你有问题，问问他们！如果你为每一个困惑的领域寻找答案，并为此做好每件事，那么最终你会有一个完整的认识。你的大部分问题都可以通过 Google 解决。不要害怕 Google 你的问题，它不会嘲笑你，我保证。我仍然 Google 了我的很多目标，看看是否有人有一些示例代码，做了我想做的事情，所以不要仅仅因为你这样做了，而觉得你是个新手。

如果我还没有把 Pandas 推销给你，那么电梯演讲就是：电子表格式数据的闪电般的数据分析，具有非常强大的输入/输出机制，可以处理多种数据类型，甚至可以转换数据类型。

好的，你被推销了。现在让我们获取 Pandas！首先，我将假设有些人甚至还没有 Python。到目前为止，最简单的选择是使用预编译的 Python 发行版，比如 ActivePython，它是个快速简单的方式，将数据科学所需的所有包和依赖关系都集中在一起，而不需要一个接一个安装它们，特别是在 64 位 Windows 上。我建议获取最新版本的 64 位 Python。仅在这个系列中，我们使用 Pandas ，它需要 Numpy。我们还将使用 Matplotlib 和 Scikit-Learn，所有这些都是 ActivePython 自带的，预先编译和优化的 MKL。你可以从这里下载一个配置完整的 Python 发行版。

如果您想手动安装 Python，请转到`Python.org`，然后下载 Python 3+ 或更高版本。不要仅仅获取`2.X`。记下你下载的位版本。因为你的操作系统是 64 位的，这并是你的 Python 版本，默认总是 32 位。选择你想要的。 64 位可能有点头疼，所以如果你是新手，我不会推荐它，但 64 位是数据科学的理想选择，所以你不会被锁定在最大 2GB 的 RAM 上。如果你想装 64 位，查看`pip`安装教程可能有帮助，其中介绍了如何处理常规安装以及更棘手的 64 位软件包。如果你使用 32 位，那么现在不用担心这个教程。

所以你已经安装了 Python。接下来，转到您的终端或`cmd.exe`，然后键入：`pip install pandas`。你有没有得到`pip is not a recognized command`或类似的东西？没问题，这意味着`pip`不在你的`PATH`中。`pip`是一个程序，但是你的机器不知道它在哪里，除非它在你的`PATH`中。如果你愿意，你可以搜索如何添加一些东西到你的`PATH`中，但是你总是可以显式提供你想要执行的程序的路径。例如，在 Windows 上，Python 的`pip`位于`C:/Python34/Scripts/pip`中。 `Python34`的意思是 Python 3.4。如果你拥有 Python 3.6，那么你需要使用`Python36`，以此类推。

因此，如果常规的`pip install pandas`不起作用，那么你可以执行`C:/Python34/Scripts/pip install pandas`。

到了这里，人们争论的另一个重点是他们选择的编辑器。编辑器在事物的宏观层面中并不重要。你应该尝试多个编辑器，并选择最适合你的编辑器。无论哪个，只要你感到舒适，而且你的工作效率很高，这是最重要的。一些雇主也会迫使你最终使用编辑器 X，Y 或 Z，所以你可能不应该依赖编辑器功能。因此，我更喜欢简单的 IDLE，这就是我将用于编程的东西。再次，您可以在 Wing，emacs，Nano，Vim，PyCharm，IPython 中编程，你可以随便选一个。要打开 IDLE，只需访问开始菜单，搜索 IDLE，然后选择它。在这里，`File > New`，砰的一下，你就有了带高亮的文本编辑器和其他一些小东西。我们将在进行中介绍一些这些次要的事情。

现在，无论您使用哪种编辑器，都可以打开它，让我们编写一些简单的代码来查看数据帧。

通常，`DataFrame`最接近 Python `Dictionary` 数据结构。如果你不熟悉字典，这里有一个教程。我将在视频中注明类似的东西，并且在描述中，以及在`PythonProgramming.net`上的文本版教程中有链接。

首先，我们来做一些简单的导入：

```py
import pandas as pd
import datetime
import pandas.io.data as web
```

在这里，我们将`pandas`导入为`pd`。 这只是导入`pandas`模块时使用的常用标准。 接下来，我们导入`datetime`，我们稍后将使用它来告诉 Pandas 一些日期，我们想要拉取它们之间的数据。 最后，我们将`pandas.io.data`导入为`web`，因为我们将使用它来从互联网上获取数据。 接下来：

```py
start = datetime.datetime(2010, 1, 1)
end = datetime.datetime(2015, 8, 22)
```
在这里，我们创建`start`和`end`变量，这些变量是`datetime`对象，获取 2010 年 1 月 1 日到 2015 年 8 月 22 日的数据。现在，我们可以像这样创建数据帧：

```py
df = web.DataReader("XOM", "yahoo", start, end)
```

这从雅虎财经 API 获取 Exxon 的数据，存储到我们的`df`变量。 将你的数据帧命名为`df`不是必需的，但是它页是用于 Pandas 的非常主流的标准。 它只是帮助人们立即识别活动数据帧，而无需追溯代码。

所以这给了我们一个数据帧，我们怎么查看它？ 那么，可以打印它，就像这样：

```py
print(df)
```

所以这是很大一个空间。 数据集的中间被忽略，但仍然是大量输出。 相反，大多数人只会这样做：

```py
print(df.head())
```

输出：

```py
                 Open       High        Low      Close    Volume  Adj Close
Date                                                                       
2010-01-04  68.720001  69.260002  68.190002  69.150002  27809100  59.215446
2010-01-05  69.190002  69.449997  68.800003  69.419998  30174700  59.446653
2010-01-06  69.449997  70.599998  69.339996  70.019997  35044700  59.960452
2010-01-07  69.900002  70.059998  69.419998  69.800003  27192100  59.772064
2010-01-08  69.690002  69.750000  69.220001  69.519997  24891800  59.532285
```

这打印了数据帧的前 5 行，并且对于调试很有用，只查看了数据帧的外观。 当你执行分析等，看看你想要的东西是否实际发生了，就很有用。 不过，我们稍后会深入它。

我们可以在这里停止介绍，但还有一件事：数据可视化。 我之前说过，Pandas 和其他模块配合的很好，Matplotlib 就是其中之一。 让我们来看看！ 打开你的终端或`cmd.exe`，并执行`pip install matplotlib`。 你安装完 Pandas，我确信你应该已经获取了它，但我们要证实一下。 现在，在脚本的顶部，和其他导入一起，添加：

```py
import matplotlib.pyplot as plt
from matplotlib import style

style.use('fivethirtyeight')
```

Pyplot 是 matplotlib 的基本绘图模块。 Style  帮助我们快速美化图形，`style.use`让我们选择风格。 有兴趣了解 Matplotlib 的更多信息吗？ 查看 Matplotlib 的深入系列教程！

接下来，在我们的`print(df.head())`下方，我们可以执行如下操作：

```py
df['High'].plot()
plt.legend()
plt.show()
```

![](https://pythonprogramming.net/static/images/pandas/pandas-graph-example.png)

很酷！ 这里有个 pandas  的快速介绍，但一点也不可用。 在这个系列中，我们将会涉及更多 Pandas 的基础知识，然后转到导航和处理数据帧。 从这里开始，我们将更多地介绍可视化，多种数据格式的输入和输出，基本和进阶数据分析和操作，合并和组合数据帧，重复取样等等。

如果您迷茫，困惑，或需要澄清，请不要犹豫，给对应的视频提问。

## 二、Pandas 基础

在这个 Python 和 Pandas 数据分析教程中，我们将弄清一些 Pandas 的基础知识。 加载到 Pandas 数据帧之前，数据可能有多种形式，但通常需要是以行和列组成的数据集。 所以也许是这样的字典：

```py
web_stats = {'Day':[1,2,3,4,5,6],
             'Visitors':[43,34,65,56,29,76],
             'Bounce Rate':[65,67,78,65,45,52]}
```

我们可以将这个字典转换成数据帧，通过这样：

```py
import pandas as pd

web_stats = {'Day':[1,2,3,4,5,6],
             'Visitors':[43,34,65,56,29,76],
             'Bounce Rate':[65,67,78,65,45,52]}

df = pd.DataFrame(web_stats)
```

现在我们可以做什么？之前看到，你可以通过这样来查看简单的起始片段：

```py
print(df.head())
   Bounce Rate  Day  Visitors
0           65    1        43
1           67    2        34
2           78    3        65
3           65    4        56
4           45    5        29
```

你也可以查看后几行。为此，你需要这样做：

```py
print(df.tail())
   Bounce Rate  Day  Visitors
1           67    2        34
2           78    3        65
3           65    4        56
4           45    5        29
5           52    6        76
```

最后，你也可以传入头部和尾部数量，像这样：

```py
print(df.tail(2))
   Bounce Rate  Day  Visitors
4           45    5        29
5           52    6        76
```

你可以在这里看到左边有这些数字，`0,1,2,3,4,5`等等，就像行号一样。 这些数字实际上是你的“索引”。 数据帧的索引是数据相关，或者数据按它排序的东西。 一般来说，这将是连接所有数据的变量。 这里，我们从来没有为此目的定义任何东西，知道这个变量是什么，对于 Pandas 是个挑战。 因此，当你没有定义索引时，Pandas 会像这样为你生成一个。 现在看数据集，你能看到连接其他列的列吗？

`Day`列适合这个东西！ 一般来说，如果您有任何日期数据，日期将成为“索引”，因为这就是所有数据点的关联方式。 有很多方法可以识别索引，更改索引等等。 我们将在这里介绍一些。 首先，在任何现有的数据帧上，我们可以像这样设置一个新的索引：

```py
df.set_index('Day', inplace=True)
```

输出：

```py
     Bounce Rate  Visitors
Day                       
1             65        43
2             67        34
3             78        65
4             65        56
5             45        29
```

现在你可以看到这些行号已经消失了，同时也注意到`Day`比其他列标题更低，这是为了表示索引。 有一点需要注意的是`inplace = True`的使用。 这允许我们原地修改数据帧，意味着我们实际上修改了变量本身。 没有`inplace = True`，我们需要做一些事情：

```py
df = df.set_index('Day')
```

您也可以设置多个索引，但这是以后的更高级的主题。 你可以很容易做到这一点，但它的原因相当合理。

一旦你有了合理的索引，是一个日期时间或数字，那么它将作为一个 X 轴。 如果其他列也是数值数据，那么您可以轻松绘图。 就像我们之前做的那样，继续并执行：

```py
import matplotlib.pyplot as plt
from matplotlib import style

style.use('fivethirtyeight')
```

然后，在底部，你可以绘图。 还记得我们之前引用了特定的列嘛？也许你注意到了，但是我们可以像这样，引用数据帧中的特定项目：

```py
print(df['Visitors'])
Day
1    43
2    34
3    65
4    56
5    29
6    76
Name: Visitors, dtype: int64
```

您也可以像对象一样引用数据帧的部分，只要没有空格，就可以这样做：

```py
print(df.Visitors)
Day
1    43
2    34
3    65
4    56
5    29
6    76
Name: Visitors, dtype: int64
```

所以我们可以像这样绘制单列：

```py
df['Visitors'].plot()
plt.show()
```

我们也可以绘制整个数据帧。 只要数据是规范化的或者在相同的刻度上，效果会很好。 这是一个例子：

```py
df.plot()
plt.show()
```

注意图例如何自动添加。 你可能会喜欢的另一个很好的功能是，图例也自动为实际绘制的直线让路。 如果你是 Python 和 Matplotlib 的新手，这可能对你来说并不重要，但这不是一个正常的事情。

最后，在我们离开之前，你也可以一次引用多个列，就像这样（我们只有两列，但是多列相同）：

```py
print(df[['Visitors','Bounce Rate']])
```

所以这是括起来的列标题列表。 你也可以绘制这个。

这些是一些方法，您可以直接与数据帧进行交互，引用数据框的各个方面，带有一个示例，绘制了这些特定的方面。

## 三、IO 基础

欢迎阅读 Pandas 和 Python 数据分析第三部分。在本教程中，我们将开始讨论 Pandas IO 即输入/输出，并从一个实际的用例开始。为了得到充分的实践，一个非常有用的网站是 Quandl。 Quandl 包含大量的免费和付费数据源。这个站点的好处在于数据通常是标准化的，全部在一个地方，提取数据的方法是一样的。如果您使用的是 Python，并且通过它们的简单模块访问 Quandl 数据，那么数据将自动以数据帧返回。出于本教程的目的，我们将仅仅出于学习的目的而手动下载一个 CSV 文件，因为并不是每个数据源都会有一个完美的模块用于提取数据集。

假设我们有兴趣，在德克萨斯州的奥斯汀购买或出售房屋。那里的邮政编码是 77006。我们可以访问当地的房源清单，看看目前的价格是多少，但这并不能真正为我们提供任何真实的历史信息，所以我们只是试图获得一些数据。让我们来查询“房屋价值指数 77006”。果然，我们可以在这里看到一个索引。有顶层，中层，下层，三居室，等等。比方说，当然，我们有一个三居室的房子。我们来检查一下。原来 Quandl 已经提供了图表，但是我们还是要抓取数据集，制作自己的图表，或者做一些其他的分析。访问“下载”，并选择 CSV。Pandas 的 IO 兼容 csv，excel 数据，hdf，sql，json，msgpack，html，gbq，stata，剪贴板和 pickle 数据，并且列表不断增长。查看 IO 工具文档的当前列表。将该 CSV 文件移动到本地目录（您正在使用的目录/这个`.py`脚本所在的目录）。

以这个代码开始，将 CSV 加载进数据帧就是这样简单：

```py
import pandas as pd

df = pd.read_csv('ZILL-Z77006_3B.csv')
print(df.head())
```

输出：

```py
         Date   Value
0  2015-06-30  502300
1  2015-05-31  501500
2  2015-04-30  500100
3  2015-03-31  495800
4  2015-02-28  492700
```

注意我们又没有了合适的索引。我们可以首先这样做来修复：

```py
df.set_index('Date', inplace = True)
```

现在，让我们假设，我们打算将它转回 CSV，我们可以：

```py
df.to_csv('newcsv2.csv')
```

我们仅仅有了一列，但是如果你有很多列，并且仅仅打算转换一列，你可以：

```py
df['Value'].to_csv('newcsv2.csv')
```

要记住我们如何绘制多列，但是并不是所有列。看看你能不能猜出如何保存多列，但不是所有列。

现在，让我们读取新的 CSV：

```py
df = pd.read_csv('newcsv2.csv')
print(df.head())
```

输出：

```py
         Date   Value
0  2015-06-30  502300
1  2015-05-31  501500
2  2015-04-30  500100
3  2015-03-31  495800
4  2015-02-28  492700
```

该死，我们的索引又没了！ 这是因为 CSV 没有像我们的数据帧那样的“索引”属性。 我们可以做的是，在导入时设置索引，而不是导入之后设置索引。 像这样：

```py
df = pd.read_csv('newcsv2.csv', index_col=0)
print(df.head())
```

输出：

```py
             Value
Date              
2015-06-30  502300
2015-05-31  501500
2015-04-30  500100
2015-03-31  495800
2015-02-28  492700
```

现在，我不了解你，但“价值”这个名字是毫无价值的。 我们可以改变这个吗？ 当然，有很多方法来改变列名，一种方法是：

```py
df.columns = ['House_Prices']
print(df.head())
```

输出：

```py
            House_Prices
Date                    
2015-06-30        502300
2015-05-31        501500
2015-04-30        500100
2015-03-31        495800
2015-02-28        492700
```
下面，我们可以尝试这样保存为 CSV：

```py
df.to_csv('newcsv3.csv')
```

如果你看看 CSV，你应该看到它拥有标题。如果不想要标题怎么办呢？没问题！

```py
df.to_csv('newcsv4.csv', header=False)
```

如果文件没有标题呢？没问题！

```py
df = pd.read_csv('newcsv4.csv', names = ['Date','House_Price'], index_col=0)
print(df.head())
```

输出：

```py
            House_Price
Date                   
2015-06-30       502300
2015-05-31       501500
2015-04-30       500100
2015-03-31       495800
2015-02-28       492700
```

这些是IO的基本知识，在输入和输出时有一些选项。

一个有趣的事情是使用 Pandas 进行转换。 所以，也许你是从 CSV 输入数据，但你真的希望在你的网站上，将这些数据展示为 HTML。 由于 HTML 是数据类型之一，我们可以将其导出为 HTML，如下所示：

```py
df.to_html('example.html')
```

现在我们有了 HTML 文件。打开它，然后你就有了 HTML 中的一个表格：

|  | House_Prices |
| --- | --- |
| Date |  |
| 2015-06-30 | 502300 |
| 2015-05-31 | 501500 |
| 2015-04-30 | 500100 |
| 2015-03-31 | 495800 |
| 2015-02-28 | 492700 |
| 2015-01-31 | 493000 |
| 2014-12-31 | 494200 |
| 2014-11-30 | 490900 |
| 2014-10-31 | 486000 |
| 2014-09-30 | 479800 |
| 2014-08-31 | 473900 |
| 2014-07-31 | 467100 |
| 2014-06-30 | 461400 |
| 2014-05-31 | 455400 |
| 2014-04-30 | 450500 |
| 2014-03-31 | 450300 |

注意，这个表自动分配了`dataframe`类。 这意味着你可以自定义 CSS 来处理数据帧特定的表！

当我有用数据的 SQL 转储时，我特别喜欢使用 Pandas。 我倾向于将数据库数据直接倒入 Pandas 数据帧中，执行我想要执行的操作，然后将数据显示在图表中，或者以某种方式提供数据。

最后，如果我们想重新命名其中一列，该怎么办？ 之前，你已经看到了如何命名所有列，但是也许你只是想改变一个列，而不必输入所有的列。 足够简单：

```py
print(df.head())

df.rename(columns={'House_Price':'Prices'}, inplace=True)
print(df.head())
```

输出：

```py
         Date  House_Price
0  2015-06-30       502300
1  2015-05-31       501500
2  2015-04-30       500100
3  2015-03-31       495800
4  2015-02-28       492700
         Date  Prices
0  2015-06-30  502300
1  2015-05-31  501500
2  2015-04-30  500100
3  2015-03-31  495800
4  2015-02-28  492700
```

所以在这里，我们首先导入了无头文件，提供了列名`Date`和`House_Price`。 然后，我们决定，我们打算用`Price`代替`House_Price`。 因此，我们使用`df.rename`，指定我们要重命名的列，然后在字典形式中，键是原始名称，值是新名称。 我们最终使用`inplace = True`，以便修改原始对象。

